var __extends=this&&this.__extends||function(t,e){function o(){this.constructor=t}for(var i in e)e.hasOwnProperty(i)&&(t[i]=e[i]);t.prototype=null===e?Object.create(e):(o.prototype=e.prototype,new o)},Model;!function(t){var e=function(){function t(t,e,o){this.id=t,this.name=e,this.score=o}return t.fromData=function(e){return new t(parseInt(e.id,10),e.name,e.score?parseFloat(e.score):0)},t}();t.Item=e}(Model||(Model={}));var Model;!function(t){var e=function(){function e(t,e,o){this.id=t,this.name=e,this.itemList=o}return e.fromData=function(o){return new e(o.id,o.name,o.item_list?o.item_list.map(function(e){return t.Item.fromData(e)}):null)},e}();t.User=e;var o=function(t){function o(){t.apply(this,arguments)}return __extends(o,t),o.fromData=function(t){var o=e.fromData(t);return o.score=parseFloat(t.score),o},o}(e);t.RecommendUser=o}(Model||(Model={}));var RecommendAlgorithm;!function(t){var e=Model.Item,o=Model.RecommendUser,i=function(){function t(){}return t.prototype.getUserData=function(t,e){for(var o=0;o<t.length;o++)if(t[o].id===e)return t[o]},t.prototype.getItemDataName=function(t,e){for(var o=0;o<t.length;o++)for(var i=0;i<t[o].itemList.length;i++)if(t[o].itemList[i].id==e)return t[o].itemList[i].name},t.prototype.getMatchItemIdList=function(t,e){for(var o=[],i=0;i<t.itemList.length;i++)for(var n=0;n<e.itemList.length;n++)t.itemList[i].id===e.itemList[n].id&&o.push(t.itemList[i].id);return o},t.prototype.getItemScore=function(t,e){for(var o=0;o<t.length;o++)if(t[o].id===e)return t[o].score},t.prototype.isSearchItem=function(t,e){for(var o=0;o<t.length;o++)if(t[o].id===e)return!0;return!1},t.prototype.pearson=function(t,e,o){var i=this,n=this.getUserData(t,e),r=this.getUserData(t,o),s=this.getMatchItemIdList(n,r),m=0,a=0,c=0,d=0,u=0,h=0,f=0,l=0;return 0==s.length?0:(h=s.length,s.forEach(function(t){m+=i.getItemScore(n.itemList,t),a+=i.getItemScore(r.itemList,t),c+=Math.pow(i.getItemScore(n.itemList,t),2),d+=Math.pow(i.getItemScore(r.itemList,t),2),u+=i.getItemScore(n.itemList,t)*i.getItemScore(r.itemList,t)}),f=u-m*a/h,l=Math.sqrt((c-Math.pow(m,2)/h)*(d-Math.pow(a,2)/h)),0==l?0:f/l)},t.prototype.getTopMatchUserList=function(t,e){var i=this,n=[];return t.forEach(function(r){r.id!==e&&n.push(o.fromData({id:r.id,name:r.name,score:i.pearson(t,e,r.id)}))}),n.sort(function(t,e){return t.score>e.score?-1:t.score<e.score?1:0}),n},t.prototype.getRecommendations=function(t,o){var i=this.getUserData(t,o),n=0,r={},s={},m=[];for(var a in t)if(t[a].id!=o&&(n=this.pearson(t,o,t[a].id),!(0>=n)))for(var c in t[a].itemList){var d=t[a].itemList[c];this.isSearchItem(i.itemList,d.id)||(void 0==r[d.id]&&(r[d.id]=0),r[d.id]+=d.score*n,void 0==s[d.id]&&(s[d.id]=0),s[d.id]+=n)}for(var u in r)m.push(e.fromData({id:u,name:this.getItemDataName(t,parseInt(u,10)),score:Math.round(r[u]/s[u]*1e4)/1e4}));return m},t}();t.RecommendModel=i}(RecommendAlgorithm||(RecommendAlgorithm={}));var e=eval,global=e("this"),RecommendAlgorithm;!function(t){var e=Model.User,o=function(t){function o(e,i){return t.call(this),this._user_list=[],this._user_id=1,o._instance?(void 0!==e&&(o._instance.setUserData(e),void 0!==i&&(o._instance._user_id=i)),o._instance):(void 0!==e&&(this.setUserData(e),void 0!==i&&(this._user_id=i)),void(o._instance=this))}return __extends(o,t),o.prototype.setUserData=function(t){var o=this;t.forEach(function(t){o._user_list.push(e.fromData(t))})},o.prototype.setUserId=function(t){this._user_id=t},o.prototype.getTopMatch=function(t){return t?this.getTopMatchUserList(this._user_list,t):this.getTopMatchUserList(this._user_list,this._user_id)},o.prototype.getRecommend=function(t){return t?this.getRecommendations(this._user_list,t):this.getRecommendations(this._user_list,this._user_id)},o._instance=null,o}(t.RecommendModel);t.Recommend=o}(RecommendAlgorithm||(RecommendAlgorithm={})),"undefined"!=typeof module&&("undefined"==typeof module.exports.Recommend&&(module.exports.Recommend={}),module.exports.Recommend=new RecommendAlgorithm.Recommend),"undefined"!=typeof global&&("undefined"==typeof global.Recommend&&(global.Recommend={}),global.Recommend=new RecommendAlgorithm.Recommend);